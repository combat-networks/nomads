<?xml version="1.0"?>

<!--
@author Marco Carvalho (mcarvalhor@ihmc.us)
@author Chris Eagle (ceagle@ihmc.us) revisions
$Revision: 1.2 $
$Date: 2016/02/03 20:32:38 $
-->

<project name="aci" default="alljars" basedir="..">
    <target name="alljars" depends="aci,grpMgr,nodemon,netsupervisor"/>
    <!-- ================================================================ -->
    <!-- Initialization target                                            -->
    <!-- ================================================================ -->
    <target name="init">
        <tstamp>
            <format property="YEAR_MONTH_DAY" pattern="yyyy-MM-dd"/>
            <format property="YEAR" pattern="yyyy"/>
        </tstamp>

        <property name="ant.build.javac.source" value="1.7"/>
        <property name="ant.build.javac.target" value="1.7"/>

        <property name="Name" value="aci"/>
        <property name="acijar-name" value="aci"/>
        <property name="acijarandroid-name" value="aci-android"/>
        <property name="avmjar-name" value="avm"/>
        <property name="disServiceProxyjar-name" value="disserviceproxy"/>
        <property name="disServiceProProxyjar-name" value="disServiceProProxy"/>
        <property name="dspro2jar-name" value="dspro2proxy"/>
        <property name="dspro2jarandroid-name" value="dspro2proxy-android"/>
		    <property name="netProxyjar-name" value="netProxy"/>
        <property name="grpmgrjar-name" value="grpMgr"/>
        <property name="nodemonjar-name" value="nodemon"/>
		    <property name="acikerneljar-name" value="acikernel" />
		    <property name="aktestjar-name" value="acitest" />
				<property name="netviewerjar-name" value="netviewer" />
        <property name="version" value="1.5"/>
        <echo message="${Name} ${version} ${YEAR_MONTH_DAY}"/>

        <property name="nomads.home" location="../"/>
        <property name="build.sysclasspath" value="ignore"/>
        <property name="externals.dir" location="../externals/java"/>
        <property name="aciexternals.dir" location="../externals/java"/>
        <property name="acibuild.dir" location="./build/antcache_aci"/>
        <property name="avmbuild.dir" location="./build/antcache_avm"/>
		    <property name="kernelbuild.dir" location="./build/antcache_kernel" />
		    <property name="aktestbuild.dir" location="./build/antcache_aktest" />
				<property name="netviewerbuild.dir" location="./build/antcache_netviewer" />
        <property name="lib.dir" location="./lib"/>
        <property name="dist.dir" location="./dist"/>
        <property name="javadoc" value="./docs/javadoc"/>

        <property name="build.compiler" value="modern"/>
        <property name="debug" value="on"/>
        <property name="optimize" value="on"/>
        <property name="deprecation" value="on"/>
        <property name="verbose" value="off"/>
        <property name="packages" value="us.ihmc.*"/>
		<property name="netsupervisor-name" value="netsupervisor"/>
        <mkdir dir="${acibuild.dir}"/>
        <mkdir dir="${avmbuild.dir}"/>
		    <mkdir dir="${kernelbuild.dir}" />
		    <mkdir dir="${aktestbuild.dir}" />
				<mkdir dir="${netviewerbuild.dir}" />
    </target>

    <!-- ================================================================ -->
    <!-- Compiles the aci source directory                                -->
    <!-- ================================================================ -->
    <target name="compile-aci" depends="init, create.fileset" description="Compiles the source directory.">
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "${nomads.home}/aci/java"/>
            <src path = "${nomads.home}/misc/java/"/>
            <src path = "${nomads.home}/util/java/"/>
            <src path = "${nomads.home}/util/resources/"/>
            <!--
            <src path = "${nomads.home}/jraf2/"/>
            -->

            <include name="us/ihmc/comm/CommHelper.java"/>
			<include name="us/ihmc/comm/CommException.java"/>

			<include name="us/ihmc/sync/ConcurrentProxy.java"/>
			<include name="us/ihmc/sync/ConcurrentProxyCallbackHandler.java"/>
			<include name="us/ihmc/sync/Mutex.java"/>
            
			<include name="us/ihmc/net/NetUtils.java"/>
            <include name="us/ihmc/net/*Custom*Factory.java"/>

            <include name="us/ihmc/util/Base64Transcoders.java"/>
            <include name="us/ihmc/util/ByteArray.java"/>
            <include name="us/ihmc/util/ByteConverter.java"/>
            <include name="us/ihmc/util/Config.java"/>
            <include name="us/ihmc/util/ConfigManager.java"/>
	    	<include name="us/ihmc/util/geo/CoordinateHelper.java"/>
	    	<include name="us/ihmc/util/geo/Position.java"/>
            <include name="us/ihmc/util/CheckUtil.java"/>	
            <include name="us/ihmc/util/Dime*.java"/>
            <include name="us/ihmc/util/HTTPHelper.java"/>
	    	<include name="us/ihmc/util/HTTPSUtils.java"/>
            <include name="us/ihmc/util/LogHelper.java"/>
            <include name="us/ihmc/util/MIMEUtils.java"/>
            <include name="us/ihmc/util/IDGenerator.java"/>
            <include name="us/ihmc/util/MD5Hash.java"/>
            <include name="us/ihmc/util/NSLookup.java"/>
	    	<include name="us/ihmc/util/ParsingUtils.java"/>
	    	<include name="us/ihmc/util/ReaderInputStream.java"/>
	    	<include name="us/ihmc/util/SortedProperties.java"/>
	    	<include name="us/ihmc/util/StringUtil.java"/>
		
            <include name="us/ihmc/util/serialization/**/*.java"/>
			
            <include name="us/ihmc/util/crypto/CryptoUtils.java"/>
            <include name="us/ihmc/util/crypto/SecureInputStream.java"/>
            <include name="us/ihmc/util/crypto/SecureOutputStream.java"/>

            <include name="us/ihmc/ds/fgraph/FGraphLocal.java"/>
            <include name="us/ihmc/ds/fgraph/FGraphInfo.java"/>
            <include name="us/ihmc/ds/fgraph/FVertex.java"/>
            <include name="us/ihmc/ds/fgraph/FEdge.java"/>
            <include name="us/ihmc/ds/fgraph/FGraphException.java"/>

            <include name="us/ihmc/**/MIMETypes.properties"/>

            <exclude name="us/ihmc/aci/kernel/**"/>
            <exclude name="us/ihmc/aci/kernel/ServiceManager.java"/>
            <exclude name="us/ihmc/aci/kernel/JavaServiceManager.java"/>
	    <exclude name="us/ihmc/aci/kernel/AromaServiceManager.java"/>
	    <exclude name="us/ihmc/aci/kernel/RVMEventHandlerThread.java"/>
	    <exclude name="us/ihmc/aci/kernel/RVMServiceEventHandler.java"/>
	    <exclude name="us/ihmc/aci/kernel/RVMServiceManager.java"/>
	    <exclude name="us/ihmc/aci/kernel/GroupManagerProxyRVMImpl.java"/>
	    <exclude name="us/ihmc/aci/kernel/GroupManagerProxyJSMImpl.java"/>
	    <exclude name="us/ihmc/aci/kernel/EmbeddedRVMServiceManager.java"/>
            <exclude name="us/ihmc/aci/servicemanager/**"/>
            <exclude name="us/ihmc/aci/grpMgr/**"/>
            <exclude name="us/ihmc/aci/coord/**"/>
            <exclude name="us/ihmc/aci/coord/resvis/**"/>
            <exclude name="us/ihmc/aci/coord/c2/**"/>

            <include name="us/ihmc/aci/util/**"/>
            <exclude name="us/ihmc/aci/util/proxy/BBNAdHocSNMPProxy.java"/>
            <include name="us/ihmc/aci/disService/**"/>           
			<include name="us/ihmc/aci/disServiceProxy/**"/>
            <include name="us/ihmc/aci/disServiceProProxy/**"/>
            <include name="us/ihmc/aci/disServiceProProxy/util/**"/>
            <include name="us/ihmc/aci/dspro2/**"/>
            <exclude name="us/ihmc/aci/agserve/**"/>
            <exclude name="us/ihmc/aci/vis/**"/>
            <include name="us/ihmc/xlayer/ds/Link.java"/>
            <include name="us/ihmc/aci/netProxy/**"/>

            <!--
            <include name="test/java/us/ihmc/jraf2/test/manager/CPUAccountManagerFactory.java"/>
            <include name="test/java/us/ihmc/jraf2/test/manager/CPUAccountManager.java"/>
            <include name="test/java/us/ihmc/jraf2/test/manager/datastructure/ThreadData.java"/>
            -->
            <classpath>
                <fileset refid="externals.fileset"/>
            </classpath>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the DisServiceProxy directory                             -->
    <!-- ================================================================== -->
    <target name="compile-disServiceProxy" depends="init, create.fileset" description="Compiles the source directory.">
	    <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <src path = "${nomads.home}/util/java/"/>

            <include name="us/ihmc/aci/disServiceProxy/**"/>

            <classpath>
                <fileset refid="externals.fileset"/>
                <pathelement location="${nomads.home}/util/lib/util.jar"/>
            </classpath>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the DSPro2 directory                                      -->
    <!-- ================================================================== -->
    <target name="compile-dspro2" depends="init, create.fileset" description="Compiles the source directory.">
	    <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <src path = "${nomads.home}/util/java/"/>


            <include name="us/ihmc/aci/dspro2/**"/>
            <include name="us/ihmc/aci/disService/DisseminationService.java"/>
            <include name="us/ihmc/aci/disService/DisseminationServiceListener.java"/>
            <include name="us/ihmc/aci/disService/PeerStatusListener.java"/>
            <include name="us/ihmc/aci/disService/SearchListener.java"/>
            <include name="us/ihmc/aci/disServiceProxy/DisseminationServiceProxy.java"/>
            <include name="us/ihmc/aci/disServiceProxy/DisseminationServiceProxyListener.java"/>
            <include name="us/ihmc/aci/disServiceProxy/DisseminationServiceProxyCallbackHandler.java"/>
            <include name="us/ihmc/aci/disServiceProxy/PeerStatusListener.java"/>
            <include name="us/ihmc/aci/disServiceProxy/SearchListener.java"/>
            
			<include name="us/ihmc/comm/**"/>
			<include name="us/ihmc/io/**"/>
			<include name="us/ihmc/sync/**"/>
			
            <classpath>
                <fileset refid="externals.fileset"/>
                <pathelement location="${nomads.home}/util/lib/util.jar"/>
            </classpath>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the DisServiceProProxy directory                          -->
    <!-- ================================================================== -->
    <target name="compile-disServiceProProxy" depends="init, create.fileset" description="Compiles the source directory.">
	    <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <src path = "${nomads.home}/util/java/"/>

            <include name="us/ihmc/aci/disServiceProProxy/**"/>
            <include name="us/ihmc/aci/disServiceProProxy/util/**"/>

            <classpath>
                <fileset refid="externals.fileset"/>
                <pathelement location="${nomads.home}/util/lib/util.jar"/>
            </classpath>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the GroupManager directory                                -->
    <!-- ================================================================== -->
    <target name="compile-grpMgr" depends="init, create.fileset" description="Compiles the source directory.">
	    <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <!-- <src path = "${nomads.home}/misc/java/"/> -->
            <!-- <src path = "${nomads.home}/util/java/"/> -->
            <include name="us/ihmc/aci/grpMgr/**"/>
            <include name="us/ihmc/aci/grpMgr/gui/**"/>
            <classpath>
                <fileset refid="externals.fileset"/>
            <!--    <pathelement location="${nomads.home}/util/lib/util.jar"/> -->
            </classpath>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the NodeMon directory                                -->
    <!-- ================================================================== -->
    <target name="compile-nodemon" depends="init, create.nodemon.fileset, grpMgr" description="Compiles the source directory.">
        <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <ant antfile="${nomads.home}/mockets/build/build.xml" dir="${nomads.home}/mockets" target="mocketsjar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.7"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <!-- <src path = "${nomads.home}/util/java/"/> -->
            <include name="us/ihmc/aci/nodemon/**"/>
            <classpath>
                <fileset refid="externals.nodemon.fileset"/>
                <pathelement location="${nomads.home}/aci/lib/util.jar"/>
                <pathelement location="${nomads.home}/aci/lib/mockets.jar"/>
                <pathelement location="${externals.dir}/log4j-1.2.17.jar"/>
                <pathelement location="${externals.dir}/commons-lang3-3.1.jar"/>
                <pathelement location="${externals.dir}/msgpack-0.6.6.jar"/>
                <pathelement location="${externals.dir}/nodemon/sigar-bin/lib/sigar.jar"/>
				<pathelement location="${externals.dir}/nodemon/snmp/snmp4j-2.3.3.jar"/>
            </classpath>
        </javac>
    </target>

	<!-- ================================================================== -->
    <!-- Compiles the netsupervisor directory                               -->
    <!-- ================================================================== -->
    <target name="compile-netsupervisor" depends="init, create.netsupervisor.fileset, nodemon" description="Compiles the source directory.">
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.7"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <!-- <src path = "${nomads.home}/util/java/"/> -->
            <include name="us/ihmc/aci/netSupervisor/**"/>
            <classpath>
				<fileset dir="${lib.dir}">
					<include name="util.jar" />
					<include name="nodemon.jar" />
				</fileset>
				<fileset dir="${nomads.home}/externals/java/netSupervisor">
					<include name="*.jar" />
				</fileset>
				<fileset dir="${nomads.home}/externals/java/nodemon">
					<include name="gson-2.3.1.jar" />
				</fileset>
				<fileset dir="${nomads.home}/externals/java/jung2-2_0_1">
					<include name="**/*.jar" />
				</fileset>
				<fileset dir="${nomads.home}/externals/java/slf4j/">
				  <include name="**/*.jar" />
				</fileset>
				<fileset dir="${nomads.home}/externals/java/jfreechart/">
				  <include name="**/*.jar" />
				</fileset>
				<pathelement location="${externals.dir}/log4j-1.2.17.jar"/>
				<pathelement location="${externals.dir}/commons-lang3-3.1.jar"/>
            </classpath>
        </javac>
    </target>
	
	
	
	
    <!-- ================================================================ -->
    <!-- Compiles the avm sources                                         -->
    <!-- ================================================================ -->
    <target name="compile-avm" depends="init, create.fileset, compile-aci-kernel">
        <javac destdir="${avmbuild.dir}"
               debug="${debug}"
               verbose="${verbose}"
               optimize="${optimize}"
               source="1.5"
               target="1.5"
               deprecation="${deprecation}">

               <src path = "${nomads.home}/avm/api"/>
               <include name="java/**/*.java"/>
               <include name="us/**/*.java"/>
               <exclude name="us/ihmc/aroma/jit/**/*.java"/>
        </javac>
    </target>

    <target name="compile-aci-kernel" depends="init">
        <javac destdir="${acibuild.dir}"
               debug="${debug}"
               verbose="${verbose}"
               optimize="${optimize}"
               source="1.5"
               deprecation="${deprecation}">
            
            <src path = "${nomads.home}/aci/java"/>
            <src path = "${nomads.home}/util/java"/>
            <include name="us/ihmc/aci/kernel/**/*.java"/>
            <include name="us/ihmc/aci/util/**/Invoke*.java"/>
            <include name="us/ihmc/aci/net/Custom*SocketFactory.java"/>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the NetProxy directory                             -->
    <!-- ================================================================== -->
    <target name="compile-netProxy" depends="init, create.fileset" description="Compiles the source directory.">
	    <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <src path = "${nomads.home}/util/java/"/>
            <src path = "${nomads.home}/externals/java/"/>

            <include name="us/ihmc/aci/netProxy/**"/>
            <include name="${externals.dir}/msgpack-0.6.6.jar"/>
            <include name="${externals.dir}/msgpack-0.6.6-sources.jar"/>
            <include name="${externals.dir}/javassist.jar"/>

            <classpath>
                <fileset refid="externals.fileset"/>
                <pathelement location="${nomads.home}/util/lib/util.jar"/>
            </classpath>
        </javac>
    </target>

    <!-- ================================================================== -->
    <!-- Compiles the DisServiceMonitor directory                             -->
    <!-- ================================================================== -->
    <target name="compile-DisServiceMonitor" depends="init, create.fileset" description="Compiles the source directory.">
	    <ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar"/>
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./java"/>
            <src path = "${nomads.home}/util/java/"/>
            <src path = "${nomads.home}/externals/java/"/>

            <include name="us/ihmc/aci/disService/monitor/**"/>
            <include name="${externals.dir}/msgpack-0.6.6.jar"/>
            <include name="${externals.dir}/msgpack-0.6.6-sources.jar"/>
            <include name="${externals.dir}/javassist.jar"/>
	    <include name="${externals.dir}/gson-2.2.4.jar"/>
            <classpath>
                <fileset refid="externals.fileset"/>
                <pathelement location="${nomads.home}/util/lib/util.jar"/>
            </classpath>
        </javac>
    </target>

	<!-- ================================================================ -->
    <!-- Creates netsupervisor.jar file                                         -->
    <!-- ================================================================ -->
    <target name="netsupervisor" depends="aci, compile-netsupervisor"
        description="Creates jar file.">
        <delete file="${lib.dir}/${netsupervisor-name}.jar"/>
        <jar jarfile="${lib.dir}/${netsupervisor-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="us/ihmc/aci/netSupervisor/**/*.class" />
            </fileset>
        </jar>
    </target>
	
    <!-- ================================================================ -->
    <!-- Creates avm.jar                                                  -->
    <!-- ================================================================ -->
    <target name="avm" depends="compile-avm"
        description="Creates jar file.">

        <delete file="${lib.dir}/${avmjar-name}.jar"/>
        <jar jarfile="${lib.dir}/${avmjar-name}.jar">
            <fileset dir="${avmbuild.dir}">
                <include name="java/**/*.class"/>
                <include name="us/ihmc/**/*.class" />
            </fileset>
        </jar>
    </target>

	
	
	
	
	
    <!-- ================================================================ -->
    <!-- Creates aci.jar file                                             -->
    <!-- ================================================================ -->
    <target name="aci" depends="compile-aci, copyImages"
        description="Creates jar file.">

        <delete file="${lib.dir}/${acijar-name}.jar"/>
        <jar jarfile="${lib.dir}/${acijar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
                <include name="us/ihmc/**/*.properties" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates aci-android.jar file                                     -->
    <!-- ================================================================ -->
    <target name="aci-android" depends="compile-aci, copyImages"
        description="Creates jar file.">
        <taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask"
        classpath="${lib.dir}/jarjar-1.2.jar"/>
        <delete file="${lib.dir}/${acijarandroid-name}.jar"/>
        <jarjar jarfile="${lib.dir}/${acijarandroid-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
            </fileset>
            <zipfileset src="${lib.dir}/javax.xml.stream-1.0.1.jar"/>
            <zipfileset src="${lib.dir}/stax-1.2.0.jar"/>
            <zipfileset src="${lib.dir}/sjsxp.jar"/>
            <rule pattern="javax.xml.**" result="us.ihmc.@1"/>
            <rule pattern="com.bea.xml.**" result="us.ihmc.xml.@1"/>
            <rule pattern="com.sun.xml.**" result="us.ihmc.com.sun.xml.@1"/>
        </jarjar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates dspro2Proxy.jar file                              -->
    <!-- ================================================================ -->
    <target name="dspro2" depends="compile-dspro2"
        description="Creates jar file.">

        <delete file="${lib.dir}/${dspro2jar-name}.jar"/>
        <jar jarfile="${lib.dir}/${dspro2jar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates dspro2Proxy-android.jar file                              -->
    <!-- ================================================================ -->
    <target name="dspro2-android" depends="compile-dspro2"
        description="Creates jar file.">
		<taskdef name="jarjar" classname="com.tonicsystems.jarjar.JarJarTask"
        classpath="${lib.dir}/jarjar-1.2.jar"/>
        <delete file="${lib.dir}/${dspro2jarandroid-name}.jar"/>
		<jarjar jarfile="${lib.dir}/${dspro2jarandroid-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
            </fileset>
            <zipfileset src="${lib.dir}/javax.xml.stream-1.0.1.jar"/>
            <zipfileset src="${lib.dir}/stax-1.2.0.jar"/>
            <zipfileset src="${lib.dir}/sjsxp.jar"/>
            <rule pattern="javax.xml.**" result="us.ihmc.@1"/>
            <rule pattern="com.bea.xml.**" result="us.ihmc.xml.@1"/>
            <rule pattern="com.sun.xml.**" result="us.ihmc.com.sun.xml.@1"/>
        </jarjar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates disServiceProxy.jar file                                 -->
    <!-- ================================================================ -->
    <target name="disServiceProxy" depends="compile-disServiceProxy"
        description="Creates jar file.">

        <delete file="${lib.dir}/${disServiceProxyjar-name}.jar"/>
        <jar jarfile="${lib.dir}/${disServiceProxyjar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates disServiceProProxy.jar file                              -->
    <!-- ================================================================ -->
    <target name="disServiceProProxy" depends="compile-disServiceProProxy"
        description="Creates jar file.">

        <delete file="${lib.dir}/${disServiceProProxyjar-name}.jar"/>
        <jar jarfile="${lib.dir}/${disServiceProProxyjar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates netProxy.jar file                              -->
    <!-- ================================================================ -->
    <target name="netProxy" depends="compile-netProxy"
        description="Creates jar file.">

        <delete file="${lib.dir}/${netProxyjar-name}.jar"/>
        <jar jarfile="${lib.dir}/${netProxyjar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="us/ihmc/**/*.class" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates grpMgr.jar file                                          -->
    <!-- ================================================================ -->
    <target name="grpMgr" depends="compile-grpMgr"
        description="Creates jar file.">
        <delete file="${lib.dir}/${grpmgrjar-name}.jar"/>
        <jar jarfile="${lib.dir}/${grpmgrjar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="us/ihmc/aci/grpMgr/**/*.class" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates nodemon.jar file                                         -->
    <!-- ================================================================ -->
    <target name="nodemon" depends="aci, compile-nodemon"
        description="Creates jar file.">
        <delete file="${lib.dir}/${nodemonjar-name}.jar"/>
        <jar jarfile="${lib.dir}/${nodemonjar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="us/ihmc/aci/nodemon/**/*.class" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates aci.jar containing also the drivers                      -->
    <!-- ================================================================ -->
    <target name="test" depends="aci, copyImages" description="Creates jar file.">
        <javac destdir="${acibuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.5"
            deprecation="${deprecation}">
            <src path = "./test/java"/>
            <src path = "${nomads.home}/util/java/"/>

            <include name="us/ihmc/aci/test/**"/>
            <include name="${env.NOMADS_HOME}/mockets/lib/mockets.jar"/>

            <classpath>
                <fileset refid="externals.fileset"/>
            </classpath>
        </javac>

        <delete file="${lib.dir}/${acijar-name}.jar"/>
        <jar jarfile="${lib.dir}/${acijar-name}.jar">
            <fileset dir="${acibuild.dir}">
                <include name="edu/uwf/**/*.class" />
                <include name="us/ihmc/**/*.class" />
                <include name="us/ihmc/**/*.gif" />
                <include name="us/ihmc/**/*.jpg" />
            </fileset>
        </jar>
    </target>

    <!-- ================================================================ -->
    <!-- Creates distribution direction                                   -->
    <!-- ================================================================ -->
    <target name="dist-bin" depends="aci, avm"
        description="Creates distribution directory.">
        <delete dir="${dist.dir}"/>
        <mkdir dir="${dist.dir}"/>
        <copy todir="${dist.dir}/bin">
            <fileset dir="./bin"/>
        </copy>
        <copy todir="${dist.dir}/conf">
            <fileset dir="./conf"/>
        </copy>
        <copy todir="${dist.dir}/lib">
                <fileset dir="${lib.dir}"/>
        </copy>
         <copy todir="${dist.dir}/externals">
            <fileset refid="externals.fileset"/>
        </copy>
    </target>

    <!-- ================================================================ -->
    <!-- Creates distribution direction (code)                            -->
    <!-- ================================================================ -->
    <target name="dist" depends="init">
        <delete dir="${dist.dir}"/>
        <mkdir dir="${dist.dir}"/>
        <tstamp>
            <format property="build.timestamp" pattern="yyyyMMdd"/>
        </tstamp>
        <zip destfile="${dist.dir}/ihmc_aci_${build.timestamp}.zip">
            <fileset dir="${nomads.home}">
                <!--Adding source C++ code-->

                <include name="aci/cpp/grpMgr/**/*.cpp"/>
                <include name="aci/cpp/grpMgr/**/*.h"/>
                <include name="aci/cpp/grpMgr/win32/grpMgr.sln"/>
                <include name="aci/cpp/grpMgr/win32/grpMgrLib.vcproj"/>
                <include name="aci/cpp/grpMgr/**/Makefile*"/>

                <include name="aci/cpp/DisService/**/*.cpp"/>
                <include name="aci/cpp/DisService/**/*.h"/>
                <include name="aci/cpp/DisService/**/*.sln"/>
                <include name="aci/cpp/DisService/**/*.vcproj"/>
                <include name="aci/cpp/DisService/**/Makefile*"/>

                <!--Adding source C# code-->
                <include name="aci/cs/DisService*/**/*.cs"/>
                <include name="aci/cs/DisService*/**/*.csproj"/>
                <include name="aci/cs/DisService*/**/*.sln"/>

                <!--Adding source Java code-->
                <include name="aci/java/us/ihmc/aci/disServiceProxy/**"/>
                <include name="aci/java/us/ihmc/aci/grpMgr/**"/>
                <include name="aci/java/us/ihmc/aci/servicemanager/**"/>
                <exclude name="aci/java/us/ihmc/aci/servicemanager/debug/**"/>

                <!--Adding aci/externals/kaos-->
                <include name="aci/externals/kaos/**/*.cpp"/>
                <include name="aci/externals/kaos/**/*.h"/>
                <include name="aci/externals/kaos/**/Makefile*"/>
                <include name="aci/externals/kaos/**/*.sln"/>
                <include name="aci/externals/kaos/**/*.vcproj"/>

                <!--Adding C++ drivers-->
                <include name="aci/test/cpp/grpMgr/**/*.cpp"/>
                <include name="aci/test/cpp/grpMgr/**/*.h"/>
                <include name="aci/test/cpp/grpMgr/win32/*.sln"/>
                <include name="aci/test/cpp/grpMgr/win32/*.vcproj"/>
                <include name="aci/test/cpp/grpMgr/linux/Makefile"/>

                <include name="aci/test/cpp/**/*.cpp"/>
                <include name="aci/test/cpp/**/*.h"/>
                <include name="aci/test/cpp/**/*.sln"/>
                <include name="aci/test/cpp/**/*.vcproj"/>

                <!--Adding Java drivers-->
                <include name="aci/test/java/**"/>

                <!--Adding some scripts for executing the drivers-->
                <include name="aci/scripts/runGroupManager.*"/>
                <include name="aci/scripts/runServiceManager*"/>

                <!--Adding documents-->
                <include name="aci/docs/packets_structure.vsd"/>

                <!--Creating empty directories and adding other files-->
                <include name="aci/bin"/>
                <include name="aci/lib"/>
                <include name="aci/build/build.xml"/>
                <include name="aci/conf/grpMgr.properties"/>
            </fileset>
        </zip>
    </target>

	<target name="create.netsupervisor.fileset">
        <fileset dir="${nomads.home}" id="externals.netsupervisor.fileset">
			<include name="externals/java/slf4j/*.jar" />
			<include name="externals/java/netSupervisor/*.jar/" />
        </fileset>
    </target>
	
	
	
	
	
	
	
	
    <!-- ================================================================ -->
    <!-- List of Externals                                                -->
    <!-- ================================================================ -->
    <target name="create.fileset">
        <echo message="Externals = ${externals.dir}"/>
        <fileset dir="${nomads.home}" id="externals.fileset">
            <include name="externals/**/*.jar"/>
            <include name="aci/externals/*.jar"/>
            <!--include name="${externals.dir}/xerces.jar"/>
            <include name="${externals.dir}/xercesImpl.jar"/>
            <include name="${externals.dir}/snmp4_13.jar"/>
            <include name="${externals.dir}/JavaSNMP.jar"/>
            <include name="${externals.dir}/cryptix32.jar"/>
            <include name="${externals.dir}/bcprov-jdk14-123.jar"/>
            <include name="${externals.dir}/puretls.jar"/>
            <include name="${externals.dir}/comm.jar"/>
            <include name="${externals.dir}/kaos_aci_client.jar"/>
            <include name="${externals.dir}/commons-collections-3.2.jar"/>
            <include name="${externals.dir}/xpp3_xpath-1.1.3.4.O.jar"/>
            <include name="${externals.dir}/xpp3-1.1.4.jar"/>
            <include name="${externals.dir}/dom4j-1.6.1.jar"/>
            <include name="${externals.dir}/jcommon-1.0.6.jar"/>
            <include name="${externals.dir}/msgpack-0.6.6.jar"/>
            <include name="${externals.dir}/msgpack-0.6.6-sources.jar"/>
            <include name="${externals.dir}/jfreechart-1.0.3.jar"/-->
        </fileset>
    </target>
		
	<target name="create.kernel.fileset">
				<fileset dir="${nomads.home}" id="externals.kernel.fileset">
            <include name="externals/java/slf4j/*.jar" />
						<include name="externals/java/commons-configuration-1.10.jar" />
						<include name="externals/java/msgpack-0.6.6.jar" />
						<include name="externals/java/log4j-1.2.17.jar" />
						<include name="externals/java/commons-lang-2.5.jar" />
						<include name="externals/java/commons-logging-1.1.1.jar" />
        </fileset>
	</target>

    <target name="create.nodemon.fileset">
            <fileset dir="${nomads.home}" id="externals.nodemon.fileset">
                <include name="externals/java/slf4j/*.jar" />
                <include name="externals/java/nodemon/*.jar/" />
        </fileset>
    </target>

    <!-- ================================================================ -->
    <!-- Makes the javadocs                                               -->
    <!-- ================================================================ -->
    <target name="javadoc" depends="init"
        description="Creates javadocs.">
        <mkdir dir="${javadoc}"/>
        <javadoc packagenames="${packages}"
            sourcepath="./java"
            destdir="${javadoc}"
            author="true"
            version="true"
            verbose="false"
            use="true"
            noindex="false"
            source="1.5"
            windowtitle="${Name} ${version} API"
            doctitle="${Name} v. ${version}"
            bottom="ACI, Copyright &#169; ${YEAR}, Institute for Human and Machine Cognition (IHMC). For information contact Niranjan Suri, nsuri@ihmc.us.">
        </javadoc>
    </target>

    <!-- ================================================================ -->
    <!-- Copies gif/jpg images into cache directory.                      -->
    <!-- ================================================================ -->
    <target name="copyImages">
        <copy todir="${acibuild.dir}">
            <fileset dir="${nomads.home}/aci/java/">
                <include name="us/ihmc/aci/**/*.gif"/>
                <include name="us/ihmc/aci/**/*.jpg"/>
            </fileset>
        </copy>
	<copy todir="${acibuild.dir}">
		<fileset dir="../util/resources">
                <include name="us/ihmc/**/MIMETypes.properties" />
            </fileset>
        </copy>
    </target>

    <!-- ================================================================ -->
    <!-- Cleans build directories.                                        -->
    <!-- ================================================================ -->
    <target name="clean" depends="init"
        description="Cleans build directories.">
			<delete dir="${acibuild.dir}"/>
			<delete dir="${avmbuild.dir}"/>
			<delete dir="${kernelbuild.dir}"/>
			<delete dir="${netviewerbuild.dir}"/>
			<delete dir="${dist.dir}"/>
			<delete file="${lib.dir}/${acijar-name}.jar"/>
			<delete file="${lib.dir}/${dspro2jarandroid-name}.jar"/>
			<delete file="${lib.dir}/agserve.jar" />
			<delete file="${lib.dir}/${avmjar-name}.jar"/>
			<delete file="${lib.dir}/${grpmgrjar-name}.jar"/>
            <delete file="${lib.dir}/${nodemonjar-name}.jar"/>
			<delete file="${lib.dir}/${acikerneljar-name}.jar"/>
			<delete file="${lib.dir}/${netviewerjar-name}.jar"/>
			<delete file="${lib.dir}/${netsupervisor-name}.jar"/>
    </target>
		
		<!-- ================================================================ -->
    <!-- Compiles the aci source directory                                -->
    <!-- ================================================================ -->
    <target name="compile-agserve" depends="init, create.fileset" description="Compiles the source directory.">
			<javac destdir="${acibuild.dir}"
					   debug="${debug}"
					   verbose="${verbose}"
					   optimize="${optimize}"
					   source="1.5"
					   deprecation="${deprecation}">
				<src path = "${nomads.home}/aci/java"/>
				<src path = "${nomads.home}/misc/java/"/>
				<src path = "${nomads.home}/util/java/"/>
				<!--
				<src path = "${nomads.home}/jraf2/"/>
				-->

				<include name="us/ihmc/comm/CommHelper.java"/>
				<include name="us/ihmc/net/NetUtils.java"/>
				<include name="us/ihmc/net/*Custom*Factory.java"/>

				<include name="us/ihmc/util/Base64Transcoders.java"/>
				<include name="us/ihmc/util/ByteArray.java"/>
				<include name="us/ihmc/util/ByteConverter.java"/>
				<include name="us/ihmc/util/Config.java"/>
				<include name="us/ihmc/util/ConfigManager.java"/>
				<include name="us/ihmc/util/geo/CoordinateHelper.java"/>
				<include name="us/ihmc/util/geo/Position.java"/>
				<include name="us/ihmc/util/CheckUtil.java"/>	
				<include name="us/ihmc/util/Dime*.java"/>
				<include name="us/ihmc/util/HTTPHelper.java"/>
				<include name="us/ihmc/util/HTTPSUtils.java"/>
				<include name="us/ihmc/util/LogHelper.java"/>
				<include name="us/ihmc/util/IDGenerator.java"/>
				<include name="us/ihmc/util/MD5Hash.java"/>
				<include name="us/ihmc/util/MIMEUtils.java"/>
				<include name="us/ihmc/util/NSLookup.java"/>
				<include name="us/ihmc/util/ParsingUtils.java"/>
				<include name="us/ihmc/util/ReaderInputStream.java"/>
				<include name="us/ihmc/util/SortedProperties.java"/>
				<include name="us/ihmc/util/StringUtil.java"/>
				<include name="us/ihmc/netSupervisor/**"/>
				<include name="us/ihmc/util/serialization/**/*.java"/>
		
				<include name="us/ihmc/util/crypto/CryptoUtils.java"/>
				<include name="us/ihmc/util/crypto/SecureInputStream.java"/>
				<include name="us/ihmc/util/crypto/SecureOutputStream.java"/>

				<include name="us/ihmc/ds/fgraph/FGraphLocal.java"/>
				<include name="us/ihmc/ds/fgraph/FGraphInfo.java"/>
				<include name="us/ihmc/ds/fgraph/FVertex.java"/>
				<include name="us/ihmc/ds/fgraph/FEdge.java"/>
				<include name="us/ihmc/ds/fgraph/FGraphException.java"/>

				<include name="us/ihmc/aci/kernel/**"/>
				<include name="us/ihmc/aci/kernel/ServiceManager.java"/>
				<include name="us/ihmc/aci/kernel/JavaServiceManager.java"/>
				<include name="us/ihmc/aci/kernel/AromaServiceManager.java"/>
				<include name="us/ihmc/aci/kernel/RVMEventHandlerThread.java"/>
				<include name="us/ihmc/aci/kernel/RVMServiceEventHandler.java"/>
				<include name="us/ihmc/aci/kernel/RVMServiceManager.java"/>
				<include name="us/ihmc/aci/kernel/GroupManagerProxyRVMImpl.java"/>
				<include name="us/ihmc/aci/kernel/GroupManagerProxyJSMImpl.java"/>
				<include name="us/ihmc/aci/kernel/EmbeddedRVMServiceManager.java"/>
				<include name="us/ihmc/aci/servicemanager/**"/>
				<include name="us/ihmc/aci/grpMgrOld/**"/>
				<include name="us/ihmc/aci/coord/**"/>
				<include name="us/ihmc/aci/coord/resvis/**"/>
				<include name="us/ihmc/aci/coord/c2/**"/>

				<include name="us/ihmc/aci/util/**"/>
				<include name="us/ihmc/aci/util/proxy/BBNAdHocSNMPProxy.java"/>
				<include name="us/ihmc/aci/disService/**"/>
				<include name="us/ihmc/aci/disServiceProxy/**"/>
				<include name="us/ihmc/aci/disServiceProProxy/**"/>
				<include name="us/ihmc/aci/disServiceProProxy/util/**"/>
				<include name="us/ihmc/aci/dspro2/**"/>
				<include name="us/ihmc/aci/agserve/**"/>
				<include name="us/ihmc/aci/vis/**"/>
				<include name="us/ihmc/xlayer/ds/Link.java"/>
				<include name="us/ihmc/aci/netProxy/**"/>
				<include name="us/ihmc/nodeMon/**"/>
				
				<include name="us/ihmc/aci/test/ACIAgServeClientTest.java" />

				<!--
				<include name="test/java/us/ihmc/jraf2/test/manager/CPUAccountManagerFactory.java"/>
				<include name="test/java/us/ihmc/jraf2/test/manager/CPUAccountManager.java"/>
				<include name="test/java/us/ihmc/jraf2/test/manager/datastructure/ThreadData.java"/>
				-->
				<classpath>
						<fileset refid="externals.fileset"/>
				</classpath>
			</javac>
    </target>
		
		<target name="compile-agserve-jar" depends="compile-agserve">
			<jar jarfile="${lib.dir}/agserve.jar">
				<fileset dir="${acibuild.dir}">
					<include name="us/ihmc/**/*.class" />
				</fileset>
			</jar>
		</target>

		<!-- ================================================================ -->
    <!-- Compiles the aci kernel                                          -->
    <!-- ================================================================ -->
		
		<target name="compile-acikernel" depends="init, create.kernel.fileset, nodemon, netviewer, netsupervisor" 
		        description="Compiles the aci kernel">
			<ant antfile="${nomads.home}/util/build/build.xml" dir="${nomads.home}/util" target="utiljar" />
			<!--ant antfile="${nomads.home}/mockets/build/build.xml" dir="${nomads.home}/mockets" target="mocketsjar" /-->
			<ant antfile="${nomads.home}/mockets/build/build.xml" dir="${nomads.home}/mockets" target="mocketsMonitorjar" />
			<javac destdir="${kernelbuild.dir}"
           debug="${debug}"
           verbose="${verbose}"
           optimize="${optimize}"
           source="1.7"
					 target="1.7" 
           deprecation="${deprecation}">
				<src path = "${nomads.home}/aci/java/" />
				<include name="us/ihmc/aci/newKernel/**" />
				<classpath>
					<fileset dir="${lib.dir}">
						<include name="util.jar" />
						<!--include name="mockets.jar" /-->
						<include name="mocketsMonitor.jar" />
						<include name="${nodemonjar-name}.jar" />
						<include name="${netsupervisor-name}.jar" />
						<include name="${netviewerjar-name}.jar" />
					</fileset>
					<fileset refid="externals.kernel.fileset" />
					<fileset dir="${nomads.home}/externals/java/nodemon">
						<include name="gson-2.3.1.jar" />
					</fileset>
					<fileset dir="${nomads.home}/externals/java/jung2-2_0_1">
						<include name="**/*.jar" />
					</fileset>
					<fileset dir="${nomads.home}/externals/java/slf4j/">
            <include name="**/*.jar" />
          </fileset>
				</classpath>
			</javac>
		</target>
		
		<!-- ================================================================ -->
    <!-- Creates acikernelar file                                         -->
    <!-- ================================================================ -->
		
		<target name="acikernel" depends="compile-acikernel" 
		        description="Creates the jar containing the aci kernel">
			<jar jarfile="${lib.dir}/${acikerneljar-name}.jar">
				<fileset dir="${kernelbuild.dir}">
					<include name="us/ihmc/**/*.class" />
				</fileset>
			</jar>
		</target>

		<!-- ================================================================ -->
    <!-- Compiles the aci kernel tests and creates the acitest.jar        -->
    <!-- ================================================================ -->
		
		<target name="acikernel-test" 
		        depends="acikernel" 
						description="Creates jar file for aci kernel tests">
        <javac destdir="${aktestbuild.dir}"
            debug="${debug}"
            verbose="${verbose}"
            optimize="${optimize}"
            source="1.7"
            deprecation="${deprecation}">
						
            <src path = "${nomads.home}/aci/java/" />
            <include name="us/ihmc/aci/test/HTTPAgServeClientTest.java" />

            <classpath>
                <fileset refid="externals.kernel.fileset" />
								<fileset dir="${lib.dir}">
									<include name="${acikerneljar-name}.jar" />
									<include name="util.jar" />
								</fileset>
            </classpath>
        </javac>

        <delete file="${lib.dir}/${aktestjar-name}.jar" />
        <jar jarfile="${lib.dir}/${aktestjar-name}.jar">
            <fileset dir="${aktestbuild.dir}">
                <include name="us/ihmc/**/*.class" />
            </fileset>
        </jar>
    </target>
		
		<!-- ================================================================ -->
    <!-- Compiles the netviewer                                           -->
    <!-- ================================================================ -->
		
		<target name="compile-netviewer" depends="init, nodemon" description="Compiles the net viewer">
			<ant antfile="${nomads.home}/util/build/build-fx.xml" dir="${nomads.home}/util" />
			<javac destdir="${netviewerbuild.dir}"
           debug="${debug}"
           verbose="${verbose}"
           optimize="${optimize}"
           source="1.8"
					 target="1.8" 
           deprecation="${deprecation}">
				<src path = "${nomads.home}/aci/java/" />
				<include name="us/ihmc/aci/netviewer/**" />
				<exclude name="us/ihmc/aci/netviewer/scenarios/**" />
				<classpath>
					<fileset dir="${lib.dir}">
						<include name="util.jar" />
						<include name="nodemon.jar" />
						<include name="charts-fx.jar" />
					</fileset>
					<fileset dir="${nomads.home}/externals/java/netviewer">
						<include name="*.jar" />
					</fileset>
					<fileset dir="${nomads.home}/externals/java/nodemon">
						<include name="gson-2.3.1.jar" />
					</fileset>
					<fileset dir="${nomads.home}/externals/java/jung2-2_0_1">
						<include name="**/*.jar" />
					</fileset>
					<fileset dir="${nomads.home}/externals/java/slf4j/">
                      <include name="**/*.jar" />
                    </fileset>
					<fileset dir="${nomads.home}/externals/java/jfreechart/">
                      <include name="**/*.jar" />
                    </fileset>
					<pathelement location="${externals.dir}/log4j-1.2.17.jar"/>
					<pathelement location="${externals.dir}/commons-lang3-3.1.jar"/>
				</classpath>
			</javac>
		</target>
		
		<!-- ================================================================ -->
    <!-- Creates netviewerar file                                         -->
    <!-- ================================================================ -->
		
		<target name="netviewer" depends="compile-netviewer" 
		        description="Creates the jar containing the net viewer">
			<jar jarfile="${lib.dir}/${netviewerjar-name}.jar">
				<fileset dir="${netviewerbuild.dir}">
					<include name="us/ihmc/**/*.class" />
				</fileset>
			</jar>
		</target>

</project>
